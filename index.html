<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CorePosture Chiropractic Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .chatbot {
            width: 420px;
            height: 650px;
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08), 0 8px 16px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            background: linear-gradient(135deg, #2d5aa0 0%, #1e3c72 100%);
            color: white;
            padding: 32px 24px 28px 24px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none;
        }
        
        .header h2 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 20px;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }
        
        .header p {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            opacity: 0.9;
            letter-spacing: 0.01em;
        }
        
        .status-dot {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
        
        .messages {
            flex: 1;
            padding: 24px 20px;
            overflow-y: auto;
            background: #fafbfc;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(45, 90, 160, 0.02) 1px, transparent 0);
            background-size: 20px 20px;
        }
        
        .messages::-webkit-scrollbar {
            width: 4px;
        }
        
        .messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .messages::-webkit-scrollbar-thumb {
            background: rgba(45, 90, 160, 0.2);
            border-radius: 2px;
        }
        
        .message {
            margin: 16px 0;
            animation: fadeInUp 0.4s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(16px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .bot-message {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .bot-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2d5aa0, #1e3c72);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 12px;
            margin-right: 12px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(45, 90, 160, 0.3);
        }
        
        .bot-bubble {
            background: #ffffff;
            padding: 16px 20px;
            border-radius: 20px 20px 20px 4px;
            max-width: 80%;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(45, 90, 160, 0.06);
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
        }
        
        .user-message {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        
        .user-bubble {
            background: linear-gradient(135deg, #2d5aa0, #1e3c72);
            color: white;
            padding: 16px 20px;
            border-radius: 20px 20px 4px 20px;
            max-width: 80%;
            box-shadow: 0 2px 12px rgba(45, 90, 160, 0.3);
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .booking-buttons {
            margin: 16px 0 8px 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .booking-btn {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 16px;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
        }
        
        .booking-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.35);
        }
        
        .quick-btns {
            margin: 16px 0 8px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .quick-btn {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #495057;
            transition: all 0.2s ease;
        }
        
        .quick-btn:hover {
            background: #e9ecef;
            border-color: #2d5aa0;
            color: #2d5aa0;
            transform: translateY(-1px);
        }
        
        .input-area {
            padding: 20px 24px 24px 24px;
            background: #ffffff;
            border-top: 1px solid #f1f3f4;
        }
        
        .input-wrapper {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 24px;
            padding: 4px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .input-wrapper:focus-within {
            background: #ffffff;
            border-color: #2d5aa0;
            box-shadow: 0 0 0 4px rgba(45, 90, 160, 0.1);
        }
        
        .input-field {
            flex: 1;
            border: none;
            background: transparent;
            padding: 14px 20px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            outline: none;
            color: #374151;
        }
        
        .input-field::placeholder {
            color: #9ca3af;
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
        }
        
        .send-btn {
            background: linear-gradient(135deg, #2d5aa0, #1e3c72);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
            margin: 2px;
            box-shadow: 0 2px 8px rgba(45, 90, 160, 0.3);
        }
        
        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(45, 90, 160, 0.4);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            color: #6b7280;
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 11px;
            text-align: center;
            padding: 8px 16px 0 16px;
            letter-spacing: 0.02em;
        }
        
        .bot-name {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: #2d5aa0;
            margin-bottom: 4px;
            font-size: 13px;
        }
        
        .user-name {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 4px;
            font-size: 13px;
        }
        
        /* Mobile responsiveness */
        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            
            .chatbot {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }
            
            .header {
                padding: 40px 24px 32px 24px;
            }
            
            .messages {
                padding: 20px 16px;
            }
            
            .input-area {
                padding: 16px 20px 32px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="chatbot">
        <div class="header">
            <h2>CorePosture Chiropractic</h2>
            <p>Newport Beach, CA • AI Assistant</p>
        </div>
        
        <div class="messages" id="messages">
            <!-- Welcome message will be added by JavaScript -->
        </div>
        
        <div class="input-area">
            <div class="input-wrapper">
                <input type="text" id="userInput" class="input-field" placeholder="Ask me anything about CorePosture..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()" class="send-btn">
                    ➤
                </button>
            </div>
        </div>
        
        <div class="status" id="status">Ready • AI Assistant</div>
    </div>

    <script>
        console.log('🚀 Chatbot script starting...');
        
        // Wait for page to fully load
        window.addEventListener('load', function() {
            console.log('✅ Page loaded, initializing chatbot...');
            initializeChatbot();
        });
        
        function initializeChatbot() {
            console.log('🔧 Setting up chatbot...');
            
            // Add welcome message
            const welcomeMessage = `
                <div class="bot-message">
                    <div class="bot-avatar">CP</div>
                    <div class="bot-bubble">
                        <div class="bot-name">CorePosture Assistant</div>
                        Hi! 👋 Welcome to CorePosture Chiropractic in Newport Beach! I can help with questions about CBP treatment, scoliosis care, insurance, and scheduling. How can I help you today?
                        
                        <div class="quick-btns">
                            <span class="quick-btn" onclick="sendQuick('What is CBP?')">CBP Treatment</span>
                            <span class="quick-btn" onclick="sendQuick('Scoliosis help')">Scoliosis</span>
                            <span class="quick-btn" onclick="sendQuick('Insurance')">Insurance</span>
                            <span class="quick-btn" onclick="sendQuick('Book appointment')">Book Now</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('messages').innerHTML = welcomeMessage;
            
            // Setup input field
            const input = document.getElementById('userInput');
            if (input) {
                input.focus();
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        console.log('📝 Enter key pressed');
                        sendMessage();
                    }
                });
            }
            
            console.log('✅ Chatbot initialized successfully!');
        }
        
        // ENHANCED SYSTEM PROMPT - Fully trained on CorePosture services
        const SYSTEM_PROMPT = `You are Dr. Tyler's AI assistant for CorePosture Chiropractic in Newport Beach, California. You have been trained on the practice's specific services, patient reviews, and 10+ years of patient interactions.

PRACTICE IDENTITY & CREDENTIALS:
- Founded by Dr. Tyler Meier, DC - Board-certified, CBP certified, Magna Cum Laude graduate
- One of only a handful of CBP practitioners in California 
- 300+ 5-star Google & Yelp reviews, 2,000+ patients successfully treated
- Specialized team: Dr. Julia Rose, Anna (Clinic Manager), Justene & Sam (Assistants)
- Phone: 949-536-5506 | Newport Beach, CA | www.coreposturechiropractic.com

OFFICE HOURS:
Monday, Wednesday, Friday: 8:45am-12:30pm & 3:30pm-6:00pm
Tuesday: 12:30pm-5:30pm | Thursday: 12:30pm-6:00pm
By appointment only - we usually get patients in within 1-2 days

CORE EXPERTISE - CBP (Chiropractic BioPhysics):
- The MOST researched chiropractic technique in the world
- Unlike traditional chiropractic (symptom relief), CBP corrects the underlying spinal STRUCTURE
- Scientific approach using digital X-ray analysis, mirror image traction, specific adjustments
- Addresses root causes: poor posture, auto accidents, sports injuries, birth trauma
- Typical timeline: 6-12 weeks for significant structural improvement
- Many patients avoid surgery completely with proper CBP treatment

SPECIALIZED SERVICES:

1. SCOLIOSIS TREATMENT:
- ScoliBrace technology - revolutionary OVER-CORRECTIVE bracing system
- Unlike traditional braces (just stop progression), ScoliBrace works to CORRECT curves
- Even orthopedic surgeons refer scoliosis patients to us
- Treat all ages - early intervention works best but help adults too
- Goal: reduce curves 15-30 degrees, improve posture and function

2. SCIATICA & NERVE PAIN:
- Spinal decompression therapy to relieve nerve pressure
- Mirror image traction to restore proper spinal curves
- Most patients see relief within 2-4 weeks
- Target root cause: disc problems, spinal misalignment, nerve interference

3. DISC PROBLEMS:
- Herniated, bulging, degenerated discs
- Non-surgical spinal decompression
- Specific CBP protocols to restore disc health
- High success rate avoiding surgery

4. HEADACHES & MIGRAINES:
- Address cervical spine misalignment causing headaches
- Success story: Anna (our clinic manager) cured of weekly migraines
- Focus on neck and upper spine correction

5. POSTURAL CORRECTION:
- Forward head posture, hunched shoulders, tech neck
- Comprehensive postural rehabilitation program
- Before/after X-rays show structural improvements

DIAGNOSTIC & TREATMENT PROCESS:
- Complimentary consultation (always free - emphasize this!)
- Comprehensive examination and postural analysis
- Digital X-ray analysis to identify exact structural problems
- Customized CBP treatment plan based on your specific spine
- Progress tracking with follow-up X-rays

PATIENT SUCCESS INSIGHTS (from reviews):
- "Finally found someone who could actually fix my scoliosis, not just manage it"
- "Dr. Tyler corrected problems other doctors said were impossible to fix"
- "The team explains everything clearly and makes you feel comfortable"
- "Results that last - not just temporary pain relief"
- "Professional, caring, and truly effective treatment"

INSURANCE & PAYMENT:
- For ALL insurance questions: "Most of our patients with PPO insurance are able to get reimbursed for their care 🙌. We'll verify your benefits with you at your first visit so you know exactly what's covered. Would you like me to help you get scheduled?"
- Complimentary consultation regardless of insurance status
- Payment plans available for accessibility
- Many patients save money by avoiding surgery

COMMUNICATION STYLE:
- Speak naturally and conversationally (not robotic or keyword-based)
- Adjust complexity based on how the user asks:
  * Simple questions → simple answers
  * Detailed questions → comprehensive explanations
- Use follow-up questions to understand their specific situation
- Guide toward scheduling naturally without being pushy
- Show empathy for their pain/concerns
- Build confidence in CBP's unique approach
- Use 1-2 emojis per response maximum

CONVERSATIONAL INTELLIGENCE:
- Understand context and follow-up questions like:
  * "What does that mean?" → Explain the previous concept in simpler terms
  * "How do I start?" → Guide to consultation booking
  * "Is this right for me?" → Ask about their specific condition
  * "How long does it take?" → Explain timeline based on their situation
- Remember conversation context and refer back to previous topics
- Ask clarifying questions when needed: "Are you dealing with back pain, neck issues, or something else?"

NATURAL CONVERSATION FLOW TO BOOKING:
Instead of immediately pushing appointments:
1. Understand their problem/pain first
2. Explain how CBP specifically helps their condition  
3. Share relevant success stories or outcomes
4. Naturally mention the complimentary consultation
5. Offer booking options when they show interest

BOOKING PROCESS:
When ready to schedule, provide these exact buttons:
<div style='margin: 15px 0;'><button onclick="window.open('https://coreposturechiropractic.com/schedule/', '_blank')" style='background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 14px; margin: 5px 10px 5px 0;'>🆕 New Patient</button><button onclick="window.open('https://coreposturechiropractic.com/schedule-existing/', '_blank')" style='background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 14px; margin: 5px;'>👤 Existing Patient</button></div>

NEW vs EXISTING PATIENTS:
- New Patient: Never been to CorePosture, needs complimentary consultation
- Existing Patient: Current patient booking follow-up appointments
- If unsure, ask: "Are you a current patient or would this be your first visit?"

LEAD CAPTURE INTEGRATION:
After collecting name, email, phone through conversation, always mention:
"I'll make sure this information gets to Dr. Tyler's team at drtyler@coreposture.com for follow-up."

KEY MESSAGING PRIORITIES:
1. CBP is different - corrects structure, not just symptoms
2. Complimentary consultation removes barriers
3. Scientific, research-based approach
4. Many patients avoid surgery
5. 10+ years experience, 2,000+ patients, 300+ 5-star reviews
6. Personalized treatment plans based on YOUR spine

HANDLE OBJECTIONS NATURALLY:
- Cost concerns → Emphasize complimentary consultation, insurance coverage, payment plans
- Skepticism → Share Dr. Tyler's credentials, CBP research, patient success stories
- Time commitment → Explain that fixing the root cause takes time but provides lasting results
- Fear/anxiety → Emphasize gentle approach, complimentary consultation to assess candidacy

Remember: You're not just answering questions - you're having intelligent conversations that build trust and naturally guide people toward getting the help they need.`;

        // ENHANCED BASIC RESPONSES - Much more detailed and intelligent
        const basicResponses = {
            'cbp': "CBP stands for Chiropractic BioPhysics - it's the most researched chiropractic technique in the world! 📊 Here's what makes it special: while traditional chiropractic focuses on pain relief, CBP actually corrects your spine's structure. Dr. Tyler uses digital X-ray analysis to see exactly how your spine has shifted, then creates a personalized plan using mirror image traction, specific adjustments, and corrective exercises to literally reshape your spine back to health. Most patients see significant improvement in 6-12 weeks, and many avoid surgery completely. What specific condition are you hoping to address?",
            
            'scoliosis': "We're actually one of the few practices in Southern California specializing in scoliosis correction! 🌟 Dr. Tyler uses revolutionary ScoliBrace technology - unlike traditional braces that just try to stop curves from getting worse, ScoliBrace is designed to actually CORRECT the curves back toward normal. We've had patients reduce their curves by 15-30 degrees! Even orthopedic surgeons refer their scoliosis patients to us because many want to try a non-surgical approach first. The key is our CBP protocols that address the underlying spinal structure. Are you dealing with scoliosis yourself, or asking for a family member?",
            
            'sciatica': "Sciatica can be absolutely debilitating - I completely understand! 😔 The good news is our CBP approach targets the root cause, not just the symptoms. Most sciatica comes from disc problems or spinal misalignment putting pressure on the sciatic nerve. Dr. Tyler uses gentle spinal decompression and mirror image traction to take pressure off the nerve and restore proper spinal curves. With our digital X-ray analysis, we can see exactly what's causing your nerve pain. Most patients start feeling relief within 2-4 weeks. How long have you been dealing with the sciatic pain?",
            
            'insurance': "Most of our patients with PPO insurance are able to get reimbursed for their care 🙌. We'll verify your benefits with you at your first visit so you know exactly what's covered. Would you like me to help you get scheduled?",
            
            'pain': "I'm really sorry you're dealing with pain - that's exactly why Dr. Tyler became a CBP specialist. 💙 Traditional approaches often just mask the pain temporarily, but CBP is different because we correct the underlying spinal structure that's causing your pain. Whether it's back pain, neck pain, headaches, or other issues, we use digital X-ray analysis to see exactly what's happening with your spine, then create a scientific plan to fix it. Many of our patients say things like 'I finally found someone who could actually fix the problem, not just manage it.' What type of pain are you experiencing?",
            
            'appointment': "I'd love to help you get scheduled! 📅 The great news is your first visit is always a complimentary consultation - Dr. Tyler wants to make sure CBP is right for you before you invest in treatment. This includes a comprehensive exam, postural analysis, and X-rays if needed. Are you a new patient, or are you currently under care with us?",
            
            'consultation': "Your complimentary consultation is really comprehensive! 🔍 Dr. Tyler will spend time understanding your health history, do a thorough postural analysis, and if needed, take digital X-rays to see exactly what's happening with your spine. Then he'll explain whether you're a candidate for CBP care and what a treatment plan might look like. There's no pressure - it's really about education and seeing if we can help. The consultation usually takes about 45 minutes. Would you like to schedule yours?",
            
            'difference': "Great question! CBP is fundamentally different from traditional chiropractic. 🎯 Most chiropractors focus on immediate pain relief - which is great for temporary help. But CBP is about correcting the underlying structural problems in your spine. Dr. Tyler is one of only a handful of CBP practitioners in California, and he uses scientific protocols with digital X-ray analysis to literally reshape your spine over time. It's like the difference between taking a painkiller (treats symptoms) versus fixing a broken bone (treats the cause). That's why our results tend to last, and why patients travel from San Diego and Los Angeles to see us. What made you interested in learning about our approach?",
            
            'traction': "Spinal traction is one of our key CBP techniques! It's actually quite comfortable - think of it as a gentle, sustained stretch that helps restore your spine's natural curves over time. 🌊 Dr. Tyler uses mirror image traction, which means if your spine has curved one way due to injury or poor posture, we apply gentle forces in the opposite direction to gradually guide it back. Combined with specific adjustments and exercises, this helps create lasting structural changes. Many patients find it relaxing! The goal is to reshape your spine so the improvements stick. Are you curious about traction for a specific condition?",
            
            'xray': "Our digital X-ray system is really the foundation of everything we do! 📸 Unlike treating based on symptoms alone, Dr. Tyler analyzes your X-rays to see exactly how your spine has shifted from ideal alignment. This lets us create a precise, scientific treatment plan tailored to YOUR specific spine. We take X-rays at the beginning to diagnose the structural problems, and then progress X-rays to track how well your spine is responding to treatment. It's amazing to see the before and after images - patients often say 'wow, I can actually see the difference!' The X-rays help us be very specific rather than just guessing. Have you had spinal X-rays taken recently?",
            
            'time': "That's a really important question! ⏰ Everyone's timeline is different because everyone's spine is unique, but here's what we typically see: Most patients start feeling some relief within the first few weeks, but the real structural changes happen over 6-12 weeks of consistent care. Think of it like straightening teeth with braces - quick fixes don't usually last, but when you actually correct the underlying structure, the results stick. Dr. Tyler will give you a much more specific timeline after analyzing your X-rays during your complimentary consultation. The good news is we track your progress with follow-up X-rays so you can actually see the improvements! What's your biggest concern about the time commitment?",
            
            'surgery': "Many of our patients come to us specifically because they want to avoid surgery! 🙏 The beautiful thing about CBP is that we're often able to correct structural problems that surgeons said were 'impossible to fix' without surgery. Dr. Tyler has helped countless patients avoid back surgery, neck surgery, and even scoliosis surgery by using scientific spinal correction techniques. Even orthopedic surgeons refer patients to us because they recognize that surgery should be a last resort. Of course, every case is different, which is why the complimentary consultation is so valuable - Dr. Tyler can look at your specific situation and give you an honest assessment. Have you been told you need surgery?",
            
            'reviews': "We're really proud of our patient reviews! 🌟 Over 300 five-star reviews on Google and Yelp from patients who've experienced real, lasting results. What patients say they love most is that we actually fix the problem rather than just managing symptoms. One of my favorites is from Anna, our clinic manager - she used to get weekly migraines for years, and other doctors just gave her medications. After CBP treatment with Dr. Tyler, she's been migraine-free! Patients often mention how much time Dr. Tyler takes to explain everything, and how the whole team makes them feel comfortable. Many say things like 'I finally found someone who could help me.' Would you like to read some of the reviews yourself?",
            
            'team': "You'll love our team! 👥 Dr. Tyler Meier founded the practice and is our CBP specialist - he graduated Magna Cum Laude with Clinical Honors and is one of only a handful of CBP practitioners in California. Dr. Julia Rose also provides excellent care. Anna is our clinic manager (and a CBP success story herself - cured of weekly migraines!). Justene brings 15+ years of dance experience and understands body mechanics really well. Sam has personal experience with back pain and knows firsthand how life-changing CBP can be. Everyone here is passionate about helping people get better because we've seen how much CBP can change lives. Who would you like to know more about?"
        };
        
        let messageCount = 0;
        let leadCapture = {
            active: false,
            step: 'none', // 'name', 'email', 'phone', 'complete'
            data: {}
        };
        
        function sendMessage() {
            console.log('📤 sendMessage() called');
            
            const input = document.getElementById('userInput');
            if (!input) {
                console.error('❌ Input field not found');
                return;
            }
            
            const message = input.value.trim();
            console.log('📝 Message:', message);
            
            if (!message) {
                console.log('⚠️ Empty message, skipping');
                return;
            }
            
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing
            document.getElementById('status').textContent = 'Thinking...';
            
            setTimeout(() => {
                if (leadCapture.active) {
                    processLeadCapture(message);
                } else {
                    processMessage(message);
                }
                document.getElementById('status').textContent = 'Ready • Basic Mode';
            }, 800);
            
            messageCount++;
            
            // Start conversational lead capture after 3 messages
            if (messageCount >= 3 && !leadCapture.active && leadCapture.step === 'none') {
                setTimeout(() => {
                    startConversationalLeadCapture();
                }, 2000);
            }
        }
        
        function startConversationalLeadCapture() {
            console.log('💬 Starting conversational lead capture');
            leadCapture.active = true;
            leadCapture.step = 'name';
            
            const messages = [
                "I'd love to help connect you with Dr. Tyler's team in Newport Beach! 😊",
                "To get you scheduled for your complimentary consultation, could you tell me your name?"
            ];
            
            messages.forEach((msg, index) => {
                setTimeout(() => {
                    addMessage(msg, 'bot');
                }, index * 1000);
            });
        }
        
        function processLeadCapture(message) {
            console.log('📋 Processing lead capture step:', leadCapture.step);
            
            switch (leadCapture.step) {
                case 'name':
                    leadCapture.data.name = message;
                    leadCapture.step = 'email';
                    addMessage(`Nice to meet you, ${message}! 👋 What's the best email address to reach you at?`, 'bot');
                    break;
                    
                case 'email':
                    leadCapture.data.email = message;
                    leadCapture.step = 'phone';
                    addMessage(`Perfect! And what's your phone number? Dr. Tyler's team will use this to confirm your appointment.`, 'bot');
                    break;
                    
                case 'phone':
                    leadCapture.data.phone = message;
                    leadCapture.step = 'complete';
                    leadCapture.active = false;
                    
                    console.log('✅ Lead captured:', leadCapture.data);
                    
                    setTimeout(() => {
                        const responses = [
                            `Excellent, ${leadCapture.data.name}! 🎉 I have all your information and I'll make sure it gets to Dr. Tyler's team at drtyler@coreposture.com.`,
                            "Our Newport Beach team will reach out within 24 hours to schedule your complimentary consultation.",
                            "In the meantime, feel free to ask me any other questions about CBP treatment, scoliosis care, or our services!",
                            `For immediate scheduling, you can call us at 949-536-5506 or book online:<div class='booking-buttons'><a href='https://coreposturechiropractic.com/schedule/' target='_blank' class='booking-btn'>🆕 New Patient</a><a href='https://coreposturechiropractic.com/schedule-existing/' target='_blank' class='booking-btn'>👤 Existing Patient</a></div>`
                        ];
                        
                        responses.forEach((response, index) => {
                            setTimeout(() => {
                                addMessage(response, 'bot');
                            }, index * 1200);
                        });
                    }, 500);
                    break;
            }
        }
        
        function sendQuick(message) {
            console.log('⚡ Quick message:', message);
            addMessage(message, 'user');
            setTimeout(() => {
                if (leadCapture.active) {
                    processLeadCapture(message);
                } else {
                    processMessage(message);
                }
            }, 800);
            messageCount++;
        }
        
        function processMessage(message) {
            console.log('🧠 Processing message:', message);
            const lower = message.toLowerCase();
            let response = '';
            
            // Find matching response
            for (const [key, value] of Object.entries(responses)) {
                if (lower.includes(key)) {
                    response = value;
                    console.log('✅ Found response for:', key);
                    break;
                }
            }
            
            // Default responses
            if (!response) {
                if (lower.includes('hello') || lower.includes('hi')) {
                    response = "Hello! 👋 Thanks for contacting CorePosture Chiropractic in Newport Beach! We specialize in CBP treatment. How can I help you today? 🌟";
                } else if (lower.includes('pain') || lower.includes('back') || lower.includes('neck')) {
                    response = "I understand you're dealing with pain. 😔 Our CBP approach targets the root cause through spinal correction. Call 949-536-5506 for your complimentary consultation to see how we can help! 💪";
                } else {
                    response = "That's a great question! 🤔 For detailed information about your specific situation, please call our Newport Beach office at 949-536-5506. Our team specializes in CBP treatment. What else can I help you with? 📞";
                }
            }
            
            addMessage(response, 'bot');
        }
        
        function addMessage(text, sender) {
            console.log('💬 Adding message:', sender, text.substring(0, 50) + '...');
            
            const messages = document.getElementById('messages');
            if (!messages) {
                console.error('❌ Messages container not found');
                return;
            }
            
            const messageDiv = document.createElement('div');
            
            if (sender === 'bot') {
                messageDiv.className = 'bot-message';
                messageDiv.innerHTML = `
                    <div class="bot-avatar">CP</div>
                    <div class="bot-bubble">
                        <div class="bot-name">CorePosture</div>
                        ${text}
                    </div>
                `;
            } else {
                messageDiv.className = 'user-message';
                messageDiv.innerHTML = `
                    <div class="user-bubble">
                        <div class="user-name">You</div>
                        ${text}
                    </div>
                `;
            }
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
            console.log('✅ Message added successfully');
        }
        
        // Remove the old popup form functions
        // No longer needed since we're using conversational lead capture
        
        // Test function to verify JavaScript is working
        function testBot() {
            console.log('🧪 Test function called - JavaScript is working!');
            addMessage('Test message - JavaScript is working!', 'bot');
        }
        
        console.log('📜 Script loaded successfully');
    </script>
</body>
</html>